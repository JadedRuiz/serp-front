<div class="container -fluid">
  <h3 class="title text-center">Ordenes de compra</h3>
  <div class="row">
      <!-- BUSCADOR DE PROVEEDORES -->
      <div class=" col-md-4">
        <mat-form-field class="w-100">
          <input
          matInput placeholder="Proveedor" aria-label="State" [matAutocomplete]="auto" [formControl]="provCtrl">
          <mat-autocomplete #auto="matAutocomplete"
          (optionSelected)="provSelec($event)"
          >
            <mat-option *ngFor="let proveedor of provFiltrados | async"
             [value]="proveedor.proveedor | uppercase"
            [id]="proveedor"
             >
              <span>{{ proveedor.proveedor | uppercase }}</span>
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>

            <div class="col-md-3">
              <input type="date" class="mt-2 form-control" aria-label="fecha" [formControl]="fechaInicio"  name="fecha1">
            </div>

            <div class="col-md-3">
              <input type="date" class="mt-2 form-control"  aria-label="fecha" [formControl]="fechaFinal" name="fecha2">
            </div>

      <div class="col-md-2">
        <button (click)="filtrarOrdenes()" class="mt-2 search-btn" >Buscar orden</button>
      </div>
  </div>
   <div  #cardPedidos class="row">
      <article class="orders-placed__container">
         <div class="w-100">
            <div class="row justify-content-center">
               <div class="col-sm-12 col-md-12 col-xl-6 mb-3 mb-sm-0" *ngFor="let pedido of pedidos">
                  <div class="card-body mt-5 orders-placed__order">
                     <h3 class="subtitle mt-0 mb-2"> <b>{{pedido.proveedor}}</b> </h3>
                     <div class="orders-placed__order__section1--subsection2">
                        <p id="folio"><b>FOLIO: </b> <span
                              (click)="seleccionarPedido(pedido.id_pedido)"><b>{{pedido.folio}}</b></span>
                        </p>
                     </div>
                     <div class="hijo">
                        <span>Fecha de entrega: <b>{{pedido.fecha | date:'dd/MM/yyyy' }}</b></span>
                     </div>
                     <div class="orders-placed__order__section2--subsection2">
                      <span>Forma de pago: <b>{{pedido.forma_pago}}</b></span>
                   </div>
                     <div class="hijo">
                        <span>Status: <b style="color: rgb(97, 187, 8);">{{pedido.status}}</b></span>
                     </div>
                     <!-- <div class="hijo">
                        <span>Fecha de pedido: <b>{{pedido.fecha_pedido}}</b></span>
                     </div> -->
                     <div>

                        <!-- <div class="orders-placed__order__section2--subsection2">
                           <span>Productos: <b>{{pedido.num_productos}}</b> </span>
                        </div> -->
                        <div class="orders-placed__order__section2--subsection2">
                           <span>Total: <b>{{pedido.importe_total | currency: ''}} </b> {{pedido.moneda_sat}}</span>
                        </div>
                        <div  class="d-flex mt-1 justify-content-end mb-2 orders-placed__order__section2--subsection1">
                           <button class="general-btn" (click)="seleccionarPedido(pedido.id_compra)" >Ver detalles</button>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>


         <!-- Modal -->
         <div class="orders-placed__modal modal-dialog-centered" *ngIf="modalVisibility">
            <div class="orders-placed__modal__order" *ngIf="orderVisibility">
               <button class="icon-btn" (click)="closeModal()">
                  <i class="fa fa-times"></i>
               </button>
               <!-- TÍTULO -->
               <h2 class="title text-center mt-4">Orden de compra para: {{pedidoSeleccionado.proveedor}} </h2>

               <!-- CUERPO DEL MODAL -->
               <div class="d-flex flex-column justify-content-start w-100 mb-3">
                  <span><b>Folio:</b> {{pedidoSeleccionado.folio}} </span>
                  <span><b>Fecha de orden:</b> {{pedidoSeleccionado.fecha | date:'dd/MM/YYYY'}} </span>
                  <span><b>Tipo de Pago:</b> {{pedidoSeleccionado.forma_pago}}  <span *ngIf="pedidoSeleccionado.forma_pago == 'CREDITO'"> <b>Días de credito</b> {{pedidoSeleccionado.dias_credito}}</span> </span>
                  <span> <b>Moneda:</b> <span>{{pedidoSeleccionado.moneda_sat}}</span> / <b>Tipo de cambio:</b> {{pedidoSeleccionado.tipo_cambio | currency}} </span>
                  <span><b>Fecha de entrega:</b> {{pedidoSeleccionado.fecha_entrega | date:'dd/MM/YYYY'}} </span>

                  <span><b>Observaciones: </b>{{pedidoSeleccionado.observaciones}}</span>
               </div>
               <div class="cotizacion" [ngStyle]="{width: '100%'}" #cotizacion>
                  <div class="table-custom mb-2" [ngStyle]="{border: '0.1px solid grey'}">
                     <div class="d-flex table-head" [ngStyle]="{border: '0.1px solid grey'}">
                        <div class="col-3 text-center">Artículo</div>
                        <div class="col-3 text-center">Cantidad</div>
                        <div class="col-3 text-center">Precio unitario</div>
                        <div class="col-3 text-center">Precio total</div>
                     </div>
                     <div class="d-flex table-body" *ngFor="let articulo of articulosPedido">
                        <div class="col-3"
                           [ngStyle]="{border: '0.1px solid grey', display: 'flex', 'align-items': 'center'}">
                           {{articulo.articulo}} {{articulo.medida}} </div>
                        <div class="col-3"
                           [ngStyle]="{border: '0.1px solid grey', display: 'flex', 'justify-content': 'center', 'align-items': 'center'}">
                           {{articulo.cantidad}}</div>
                        <div class="col-3"
                           [ngStyle]="{border: '0.1px solid grey', display: 'flex', 'justify-content': 'center', 'align-items': 'center'}">
                           ${{articulo.precio_unitario}} </div>
                        <div class="col-3"
                           [ngStyle]="{border: '0.1px solid grey', display: 'flex', 'justify-content': 'center', 'align-items': 'center'}">
                           ${{articulo.total}}</div>
                     </div>
                  </div>
                  <div class="d-flex justify-content-between w-80 mt-auto">
                     <span><b>Total:</b></span>
                     <span>{{pedidoSeleccionado.importe_total | currency}}</span>
                  </div>
               </div>
               <!-- BOTONES -->
               <div class="orders-placed__buttons mt-auto">
                  <button class="general-btn" (click)="openEdit(pedidoSeleccionado.id_compra)">Editar</button>
                  <!-- <button class="danger-btn" (click)="generarPdfCotizacion()">Ver Orden de compra</button> -->
                  <button class="danger-btn" (click)="cancelarOrden()">Cancelar orden</button>
                  <button class="search-btn" (click)="toggleModalVisibility()">Regresar</button>
               </div>
            </div>
         </div>
      </article>
   </div>
</div>
