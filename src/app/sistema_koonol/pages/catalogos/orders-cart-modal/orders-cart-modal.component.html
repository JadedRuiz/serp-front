<div class="orders-modal">
  <button class="orders-modal__close icon-btn" (click)="useToggleModalVisibility()">
    <i i class="fa fa-times"></i>
  </button>

  <!-- MODAL PARA ESCOGER UN VENDEDOR, UN CLIENTE, FECHA DE ENTREGA Y REALIZAR OBSERVACIONES PARA EL PEDIDO -->
  <div class="orders-modal__client" *ngIf="clienteVendedorModal">
    <div class="orders-modal__client-inputs row">
      <!-- Autocomplete de vendedores -->
      <div class="col-5 p-0">
        <span *ngIf="!selectSellerVisibility">
          Vendedor:
        </span>
        <div class="ng-autocomplete" *ngIf="!selectSellerVisibility">
          <input class="search-input" type="text" placeholder="Buscar vendedor" aria-label="Buscar vendedor"
            aria-describedby="button-addon2" [formControl]="searchSellerControl" (focus)="onFocusSellerSearch()" />
          <div class="search-loader w-100" *ngIf="loaderSeller; else sellersReady">
            <i class="fa fa-spinner fa-pulse"></i>
          </div>
          <div class="d-flex w-100 justify-content-center p-2 border" *ngIf="noClients">
            <h4>No se encontraron vendedores</h4>
          </div>
          <ng-template #sellersReady>
            <ul class="search-list" *ngIf="searchListSeller">
              <li class="search-list__element" *ngFor="let seller of autocompleteSellers"
                (click)="seleccionarVendedor(seller.id_vendedor)">
                {{ seller.vendedor }}
              </li>
            </ul>
          </ng-template>
        </div>
      </div>

      <!-- Termina Autocomplete -->

      <!-- Autocomplete de clientes -->
      <div class="col-5 p-0">
        <span>Cliente:</span>
        <div class="ng-autocomplete">
          <input class="search-input" type="text" placeholder="Buscar cliente" aria-label="Buscar cliente"
            aria-describedby="button-addon2" [formControl]="searchClientControl" (focus)="onFocusClientSearch()" />
          <div class="search-loader w-100" *ngIf="loaderCliente; else clientsReady">
            <i class="fa fa-spinner fa-pulse"></i>
          </div>
          <div class="d-flex w-100 justify-content-center p-2 border" *ngIf="noClients">
            <h4>No se encontraron clientes</h4>
          </div>
          <ng-template #clientsReady>
            <ul class="search-list" *ngIf="searchListCliente">
              <li class="search-list__element" *ngFor="let client of autocompleteClients"
                (click)="seleccionarCliente(client.id_cliente)">
                {{ client.cliente }}
              </li>
            </ul>
          </ng-template>
        </div>
      </div>
      <!-- Termina Autocomplete -->
    </div>

    <!-- Calendario -->
    <span class="m-0 mt-2">Escoger fecha de entrega:</span>
    <div class="">
      <mat-form-field>
        <input matInput [matDatepicker]="picker" placeholder="Selecciona una fecha" [(ngModel)]="selectedDate"
          (dateChange)="seleccionarFecha($event)" [min]="currentDate" />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </div>
    <!-- Termina calendario -->

    <div class="orders-modal__observations">
      <span>Observaciones:</span>
      <textarea type="text" [(ngModel)]="observaciones"></textarea>
    </div>

    <div class="orders-modal__buttons ">
      <button class="danger-btn" (click)="useToggleModalVisibility()">
        Cancelar
      </button>
      <button class="general-btn" [ngClass]="{
          'button-disabled':
            !isSellerSelected || !isClientSelected || !isDateSelected
        }" (click)="confirmClient()" [disabled]="!isClientSelected || !isSellerSelected || !isDateSelected">
        Confirmar
      </button>
    </div>
  </div>

  <!-- MODAL PARA SELECCIONAR DIRECCIÓN DEL CLIENTE -->
  <div class="orders-modal__addresses" *ngIf="selectAddressModal">
    <h3 class="title text-center">Selecciona una dirección</h3>
    <div class="orders-modal__addresses-container">
      <div class="orders-modal__addresses-list">
        <div class="orders-modal__address" *ngFor="let address of addresses">
          <label>
            <input type="radio" name="address" [(ngModel)]="addressSelected" [value]="address"
              (click)="selectAddress(address)" />
            {{ address.direccion }}
          </label>
        </div>
      </div>
    </div>
    <div class="orders-modal__buttons">
      <button class="danger-btn" (click)="backToClientModal()">Regresar</button>
      <button class="general-btn" [ngClass]="{ 'button-disabled': !isAddressSelected }" (click)="confirmAddress()"
        [disabled]="!isAddressSelected">
        Continuar
      </button>
    </div>
  </div>

  <!-- MODAL PARA VER DETALLES DEL PEDIDO Y FINALIZARLO -->
  <div class="orders-modal__fin" *ngIf="finPedidoModal">
    <h3 class="title">Datos del pedido</h3>
    <div class="orders-modal__fin-info">
      <p>
        <b> Cliente: </b> <span>{{ selectedClient.cliente }}</span>
      </p>
      <p>
        <b> Dirección: </b> <span>{{ addressSelected.direccion }}</span>
      </p>
      <p>
        <b> Fecha de entrega: </b> <span>{{ selectedDateFormatted }}</span>
      </p>
      <h3 class="subtitle text-start d-flex justify-content-between">
        <b>Total:</b> <span> ${{ precioTotalFormateado }} </span>
      </h3>
    </div>
    <span class="span-extra" (click)="openExtraModal()">El cliente no tiene fotos, ¿deseas añadir?</span>
    <div class="orders-modal__buttons">
      <button class="danger-btn" (click)="backToAddressModal()">
        Regresar
      </button>
      <button class="general-btn" (click)="finishOrder()">
        Finalizar pedido
      </button>
    </div>
  </div>

  <!-- MODAL PARA SUBIR FOTOGRAFÍAS DE UN CLIENTE EN CASO DE QUE NO LAS TENGA -->
  <div class="orders-modal__extra" *ngIf="extraModal">
    <!-- TÍTULO -->
    <h3 class="title">Añadir fotos al cliente {{selectedClient.cliente}}</h3>

    <!-- CUERPO DEL MODAL -->
    <div class="orders-modal__extra-container">
      <!-- IMAGEN PRINCIPAL -->
      <div class="orders-modal__extra-image">
        <img src="../../../../../assets/img/Placeholder1.png" alt="placeholder" *ngIf="uploadedImages.length == 0">
        <img [src]="mainImage" alt="imagen principal" *ngIf="uploadedImages.length !== 0">
      </div>
      <!-- SELECTOR DE IMÁGENES -->
      <div class="orders-modal__extra-images-selector">
        <div class="orders-modal__extra-images" *ngFor="let image of uploadedImages; let i = index"
          (click)="displayImage(i)">
          <img [src]="image" alt="imagen miniatura">
        </div>
      </div>
      <div class="d-flex flex-column">
        <!-- BOTÓN PARA AÑADIR FOTO -->
        <button class="search-btn" (click)="uploadImage()">Subir imagen</button>
        <!-- BOTÓN PARA TOMAR FOTO -->
        <button class="add-btn mt-3" (click)="takePhoto()">Tomar foto</button>
      </div>
      <!-- WEBCAM -->
      <webcam *ngIf="takingPhoto" [trigger]="triggerObservable" (imageCapture)="pushPhoto($event)"></webcam>
      <button class="icon-btn webcam-btn" *ngIf="takingPhoto" (click)="capturePhoto()" ><i class="fa fa-camera"></i></button>
    </div>

    <!-- SECCIÓN DE BOTONES -->
    <div class="orders-modal__buttons">
      <button class="danger-btn" (click)="backToFinishOrder()">
        Regresar
      </button>
      <button class="general-btn" (click)="backToFinishOrder()">
        Continuar
      </button>
    </div>
  </div>
</div>